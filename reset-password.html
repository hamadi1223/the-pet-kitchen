<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Reset your password - The Pet Kitchen">
  <meta name="theme-color" content="#C6A769">
  
  <title>Reset Password - The Pet Kitchen</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23ffffff'/><text x='50' y='70' font-size='60' text-anchor='middle'>üêæ</text></svg>">
  <link rel="apple-touch-icon" href="assets/images/hero/dog_hero.png">
  
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/auth.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="index.html" class="logo">
          <span>THE PET KITCHEN</span>
        </a>
        
        <nav class="nav desktop-nav" role="navigation">
          <ul class="nav-list">
            <li><a href="index.html" class="nav-link">ABOUT US</a></li>
            <li><a href="meal-plans.html" class="nav-link">MEAL PLANS</a></li>
            <li><a href="instructions.html" class="nav-link">INSTRUCTIONS</a></li>
            <li><a href="subscriptions.html" class="nav-link">SUBSCRIPTIONS</a></li>
            <li><a href="index.html#reviews" class="nav-link">REVIEWS</a></li>
            <li><a href="events.html" class="nav-link">EVENTS</a></li>
            <li><a href="signup.html" class="btn btn-outline">SIGN UP</a></li>
          </ul>
        </nav>

        <button type="button" id="navToggle" class="nav-toggle" aria-expanded="false" aria-controls="mobileMenu" aria-label="Toggle navigation menu">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
      </div>
    </div>

    <div id="mobileMenu" class="mobile-panel" role="dialog">
      <nav class="mobile-nav" role="navigation">
        <ul class="mobile-nav-list">
          <li><a href="index.html" class="mobile-nav-link">About Us</a></li>
          <li><a href="meal-plans.html" class="mobile-nav-link">Meal Plans</a></li>
          <li><a href="instructions.html" class="mobile-nav-link">Instructions</a></li>
          <li><a href="subscriptions.html" class="mobile-nav-link">Subscriptions</a></li>
          <li><a href="index.html#reviews" class="mobile-nav-link">Reviews</a></li>
          <li><a href="events.html" class="mobile-nav-link">Events</a></li>
          <li><a href="signup.html" class="btn btn-outline mobile-cta">Sign Up</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="auth-main">
    <div class="container">
      <div class="auth-container">
        <div class="auth-header">
          <h1>Reset Your Password</h1>
          <p>Enter your new password below</p>
        </div>

        <!-- Error message for missing/invalid token -->
        <div id="tokenErrorMessage" class="error-message" style="display: none;">
          <p>This reset link is invalid or has expired.</p>
          <p style="margin-top: 0.5rem;">
            <a href="login.html" style="color: var(--accent); text-decoration: underline;">Return to login</a> or 
            <a href="#" id="requestNewLink" style="color: var(--accent); text-decoration: underline;">request a new reset link</a>.
          </p>
        </div>

        <!-- Success message -->
        <div id="resetSuccessMessage" class="success-message" style="display: none;">
          <p><strong>Success!</strong> Your password has been reset.</p>
          <p style="margin-top: 0.5rem;">Redirecting to login page...</p>
        </div>

        <!-- Reset Password Form -->
        <form id="resetPasswordForm" class="auth-form" method="POST" action="#" onsubmit="return false;" style="display: none;">
          <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" name="newPassword" required autocomplete="new-password" minlength="6">
            <small class="form-helper">At least 6 characters</small>
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required autocomplete="new-password" minlength="6">
            <small class="form-helper">Re-enter your new password</small>
          </div>

          <div id="errorMessage" class="error-message" style="display: none;"></div>

          <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
            Reset Password
          </button>

          <p class="auth-footer">
            Remember your password? <a href="login.html">Log in here</a>
          </p>
        </form>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>ABOUT US</h4>
          <ul>
            <li><a href="index.html">How it Works</a></li>
            <li><a href="meal-plans.html">Meal Plans</a></li>
            <li><a href="instructions.html">Instructions</a></li>
            <li><a href="subscriptions.html">Subscriptions</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>SOCIALS</h4>
          <div class="social-links">
            <a href="https://www.instagram.com/thepetkitchen.kw/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="currentColor" stroke-width="2"/>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" stroke="currentColor" stroke-width="2"/>
                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke="currentColor" stroke-width="2"/>
              </svg>
            </a>
          </div>
          <h4>ADDRESS</h4>
          <address>The heart of Kuwait</address>
        </div>
      </div>
    </div>
  </footer>

  <div id="navOverlay" class="nav-overlay"></div>
  
  <!-- Inline script to show form immediately if token exists (runs after DOM is ready) -->
  <script>
    // Immediately check for token and show appropriate message
    (function() {
      function showFormIfTokenExists() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const form = document.getElementById('resetPasswordForm');
        const tokenError = document.getElementById('tokenErrorMessage');
        
        if (token && token.trim() !== '') {
          // Token exists - show form, hide error
          if (form) form.style.display = 'block';
          if (tokenError) tokenError.style.display = 'none';
        } else {
          // No token - show error, hide form
          if (tokenError) tokenError.style.display = 'block';
          if (form) form.style.display = 'none';
        }
      }
      
      // Run immediately if DOM is already loaded, otherwise wait for it
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', showFormIfTokenExists);
      } else {
        showFormIfTokenExists();
      }
    })();
  </script>
  
  <script src="js/security.js" defer></script>
  <script src="js/api.js" onload="console.log('‚úÖ api.js script tag loaded');" onerror="console.error('‚ùå api.js failed to load!');"></script>
  <script src="js/error-handler.js" defer></script>
  <script src="js/app.js" defer></script>
  <script src="js/navigation.js" defer></script>
  <script src="js/reset-password.js" defer></script>
</body>
</html>

